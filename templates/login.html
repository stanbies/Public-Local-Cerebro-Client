{% extends "base.html" %}

{% block title %}Inloggen - Cerebro Companion{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center transition-all duration-500">
    <div class="bg-white p-10 rounded-xl shadow-xl w-full max-w-sm animate-fade-in-up">
        <!-- Cerebro Logo -->
        <div class="flex justify-center items-center mb-8 transform transition-all duration-300 hover:scale-105">
            <i data-lucide="brain" class="h-10 w-10 text-blue-600 animate-pulse-slow"></i>
            <span class="ml-3 text-3xl font-bold text-gray-900 tracking-wide">Cerebro</span>
        </div>
        
        <p class="text-center text-gray-600 mb-6 text-sm">
            Lokale Companion Client
        </p>
        
        <!-- Login Form -->
        <form id="loginForm" class="space-y-5">
            <div>
                <input
                    type="text"
                    id="username"
                    name="username"
                    autocomplete="username"
                    placeholder="Gebruikersnaam"
                    required
                    class="w-full px-4 py-2 border rounded-md shadow-sm 
                           focus:outline-none focus:ring-2 focus:ring-blue-500 
                           hover:ring-2 hover:ring-blue-300 
                           transition duration-200"
                />
            </div>
            
            <div class="relative">
                <input
                    type="password"
                    id="password"
                    name="password"
                    autocomplete="current-password"
                    placeholder="Wachtwoord"
                    required
                    class="w-full px-4 py-2 border rounded-md shadow-sm 
                           focus:outline-none focus:ring-2 focus:ring-blue-500 
                           hover:ring-2 hover:ring-blue-300 
                           transition duration-200 pr-10"
                />
                <button
                    type="button"
                    id="togglePassword"
                    class="absolute right-3 top-2.5 text-gray-500 hover:text-gray-700 cursor-pointer"
                    tabindex="-1"
                >
                    <i data-lucide="eye" class="w-5 h-5" id="eyeIcon"></i>
                </button>
            </div>
            
            <div id="errorMessage" class="text-sm text-red-500 hidden"></div>
            
            <button
                type="submit"
                id="submitBtn"
                class="w-full bg-blue-600 text-white py-2 rounded-md 
                       hover:bg-blue-700 shadow-md 
                       transform hover:scale-[1.03] 
                       transition duration-200 cursor-pointer
                       disabled:opacity-50 disabled:cursor-not-allowed
                       flex items-center justify-center gap-2"
            >
                <span id="submitText">Inloggen</span>
                <i data-lucide="loader-2" class="w-5 h-5 animate-spin hidden" id="submitSpinner"></i>
            </button>
        </form>
        
        <div class="mt-6 pt-4 border-t border-gray-200">
            <p class="text-xs text-gray-500 text-center">
                Verbindt met de Cerebro cloud voor veilige medische dataverwerking
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    const form = document.getElementById('loginForm');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const togglePassword = document.getElementById('togglePassword');
    const eyeIcon = document.getElementById('eyeIcon');
    const errorMessage = document.getElementById('errorMessage');
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const submitSpinner = document.getElementById('submitSpinner');
    
    let showPassword = false;
    
    // Toggle password visibility
    togglePassword.addEventListener('click', () => {
        showPassword = !showPassword;
        passwordInput.type = showPassword ? 'text' : 'password';
        eyeIcon.setAttribute('data-lucide', showPassword ? 'eye-off' : 'eye');
        lucide.createIcons();
    });
    
    // Handle form submission
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = usernameInput.value.trim();
        const password = passwordInput.value;
        
        if (!username || !password) {
            showError('Vul gebruikersnaam en wachtwoord in.');
            return;
        }
        
        setLoading(true);
        hideError();
        
        try {
            const response = await fetch('/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password }),
            });
            
            const data = await response.json();
            
            if (response.ok) {
                // Redirect to dashboard
                window.location.href = '/ui/dashboard';
            } else {
                showError(data.detail || 'Inloggen mislukt.');
            }
        } catch (err) {
            showError('Netwerkfout. Controleer je verbinding.');
        } finally {
            setLoading(false);
        }
    });
    
    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.classList.remove('hidden');
    }
    
    function hideError() {
        errorMessage.classList.add('hidden');
    }
    
    function setLoading(loading) {
        submitBtn.disabled = loading;
        submitText.textContent = loading ? 'Bezig...' : 'Inloggen';
        submitSpinner.classList.toggle('hidden', !loading);
    }
</script>
{% endblock %}
